<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!-->
<html lang="en" class="no-js">
<!--<![endif]-->
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Silly Chat</title>
    <meta name="description" content="Sample application to
                                      demonstrate how Clojure can talk
                                      to ClojuerScript via WebSocket.">
    <meta name="author" content="Hubert Iwaniuk">
    <link href="/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css" />
    <link href="/css/print.css" media="print" rel="stylesheet" type="text/css" />
    <!--[if lt IE 8]>
    <link href="/css/ie.css" media="screen, projection" rel="stylesheet" type="text/css" />
    <![endif]-->
  </head>
  <body class="demo">
    <article id="container">
      <header id="header">
        <h1>Silly Chat</h1>
      </header>

      <section id="sidebar">
        <div>Your nickname: <span id="nick" class="nick me">no nick name</span></div>
        <header>List of participants</header>
        <ul id="participants"></ul>
        <dl id="legend">
          <dt>commands</dt>
          <dd>Commands start with <em>/</em>
            <dl>
              <dt>/nick [new-nick]</dt>
              <dd>changes your nickname to [new-nick]</dd>
              <dt>/list</dt>
              <dd>update list of users</dd>
            </dl>
          </dd>
        </dl>
      </section>
      
      <section id="content">
        <h2>Messages</h2>
        <ul id="messages">
        </ul>
        <header><label for="msg">Write your message</label></header>
        <input id="msg" type="text" class="title" label="Write your message"/>
      </section>
      
      <section>
        <header id="log-h">Debug</header>
        <div id="log"></div>
      </section>

      <footer id="footer">
        <section>
          <ul>
            <li><a href="http://clojure.org" onClick="recordOutboundLink(this, 'Outbound Links');return false;">Clojure</a></li>
            <li><a href="https://github.com/clojure/clojurescript" onClick="recordOutboundLink(this, 'Outbound Links');return false;">ClojureScript</a></li>
            <li><a href="http://dev.w3.org/html5/websockets/" onClick="recordOutboundLink(this, 'Outbound Links');return false;">WebSocket</a></li>
            <li><a href="http://github.com/neotyk/ws-cljs/" onClick="recordOutboundLink(this, 'Outbound Links');return false;">Source at GitHub</a></li>
            <li>
              <a href="http://ec2-46-137-58-250.eu-west-1.compute.amazonaws.com:8108/"
                 data-url="http://j.mp/oR4FlM"
                 data-counturl="http://ec2-46-137-58-250.eu-west-1.compute.amazonaws.com:8108/"
                 data-via="neotyk"
                 data-related="neotyk"
                 data-count="none"
                 data-text="Check out #ClojureScript talking to #Clojure over #WebSocket"
                 class="twitter-share-button">Tweet</a>
            </li>
          </ul>
        </section>
      </footer>
    </article>

    <script type="text/javascript" src="js/client.js"></script>
    <script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-24734196-2']);
      _gaq.push(['_setDomainName', 'none']);
      _gaq.push(['_setAllowLinker', true]);
      _gaq.push(['_trackPageview']);

      (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
      twttr.events.bind('tweet', function(event) {
      if (event) {
      var targetUrl;
      if (event.target && event.target.nodeName == 'IFRAME') {
      targetUrl = extractParamFromUri(event.target.src, 'url');
      }
      _gaq.push(['_trackSocial', 'twitter', 'tweet', targetUrl]);
      }
      });
      function extractParamFromUri(uri, paramName) {
      if (!uri) {
      return;
      }
      var uri = uri.split('#')[0];  // Remove anchor.
      var parts = uri.split('?');  // Check for query params.
      if (parts.length == 1) {
      return;
      }
      var query = decodeURI(parts[1]);

      // Find url param.
      paramName += '=';
      var params = query.split('&');
      for (var i = 0, param; param = params[i]; ++i) {
      if (param.indexOf(paramName) === 0) {
      return unescape(param.split('=')[1]);
      }
      }
      }
      function recordOutboundLink(link, category) {
      _gat._getTrackerByName()._trackEvent(category, link.href);
      setTimeout('document.location = "' + link.href + '"', 100);
      }
  </body>
</html>
